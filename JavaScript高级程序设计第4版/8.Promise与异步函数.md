## 同步和异步
---
* 同步行为会严格按照出现顺序执行，执行后能立即获得存储在系统本地的信息。
* 异步行为类似于系统中断，避免强制进程等待一个长时间的操作。
* 回调地狱：使用深度嵌套的回调函数串联多个异步操作。
* 异步返回值可以通过给异步操作提供一个回调函数来使用。可以在初始化异步操作时定义成功回调和失败回调。当异步返回值依赖另一个异步返回值，必须使用嵌套回调，这种策略不具有扩展性。

## 期约（Promise）
---
* 使用`new`操作符实例化，必须传入一个执行器函数作为参数，否则会抛出语法错误。
* 执行器函数用于初始化期约的异步行为和控制状态的最终转换。它传入两个函数参数，通常命名为`resolve()`和`reject()`，调用前者会将状态切换为解决，后者切换为拒绝并抛出错误。执行器函数是同步执行的。
* `promise`是一个有状态的对象：待定（`pending`）、解决（`resolved`）、拒绝（`rejected`）。当`promise`落定（`settled`）为后两种状态，状态不可逆。状态可以不脱离待定状态。
* `promise`的状态是私有的，不能被外部代码检测或修改。
* `promise`的状态切换为解决时，会有一个私有的内部值，切换为拒绝时，会有一个私有的内部理由。值和理由可选，默认为`undefined`。
* `Promise.resolve()`：实例化一个解决的`promise`，传入的第一个参数作为期约的值。
	* 它是一个幂等方法，若传入的参数为`promise`，则保留传入期约的状态。
	* 能够包装包括`Error`对象在内的非期约值，将其转换为解决的期约。
* `Promise.reject()`：实例化一个拒绝的期约，抛出一个异步错误，该错误只能通过拒绝处理程序捕获。传入的第一个参数作为期约的拒绝理由。
	* 不具有幂等性，若传入的参数为`promise`，则会成为返回的拒绝期约的理由。
	* 拒绝的期约实例是同步创建的，但拒绝期约的错误会抛到浏览器异步消息队列，需要使用异步结构来处理，也就是期约的方法。
* `Promise.prototype.then()`：用于为期约实例添加处理程序，接收两个可选参数，`onResolved`处理程序和`onRejected`处理程序，两个程序彼此互斥。
	* 如果只想提供第二个参数，需要为第一个参数传入`undefined`或`null`。
	* 该方法的返回值是一个新的`promise`，其值为通过`Promise.resolve()`包装后的处理程序的返回值。对于`onResolved`和`onRejected`处理程序采用相同的处理。
	* 若未提供处理程序，则包装上一个`promise`解决的值。若没有显式的返回语句，则包装`undefined`。若处理程序中抛出异常，则返回拒绝的期约。若返回`Error`对象，返回一个`Promise.resolve()`包装后的错误对象。
* `Promise.prototype.catch()`：相当于调用`Promise.prototype.then(null, onRejected)`。
* `Promise.prototype.finally()`：用于添加清理代码，给期约添加`onFinally`处理程序，在期约落定后执行。返回一个新的期约实例，表现为初始期约的传递，与状态无关。当处理程序返回了一个待定或拒绝的期约，或抛出了异常，会返回相应的待定或拒绝期约。
* 期约的非重入特性：期约落定后，相关的处理程序会排期，推进消息队列。同步代码先于处理程序执行，无关代码的顺序。给期约添加的多个处理程序会按照添加顺序执行。
* 期约的解决值和拒绝理由分别作为`resolve()`和`reject()`的第一个参数向后传递，由对应的处理程序接收作为唯一参数。
* 期约的实例方法可以连缀调用，因为这些方法都会返回一个新的期约对象。
* `Promise.all()`：必须接收一个可迭代对象，返回值是新的期约对象。
	* 在一组期约全部解决后才能解决，合成期约的解决值是所有包含期约解决值的数组，按照迭代器顺序。
	* 至少一个包含的期约待定，合成的期约也会待定。
	* 有一个期约拒绝，合成期约也会拒绝。合成期约的拒绝理由是第一个拒绝的期约理由。合成期约会静默处理所有包含期约的拒绝操作，不会让错误跑调。
* `Promise.race()`：必须接受一个可迭代对象，返回值是新的期约对象。
	* 第一个落定的期约，无论落定为哪种状态，包装期约会返回包装了其解决值或拒绝理由的新期约。
* 期约可以通过临时封装取消令牌来取消期约。期约进度追踪可以通过扩展`Promise`类来实现。

## 异步函数
---
* ES8新增`async`/`await`关键字，解决了利用异步结构组织代码的问题。

### async关键字
* 用于声明异步函数，可以用在函数声明、函数表达式、箭头函数和方法上。
* 返回值始终为一个期约对象，任何类型的返回值都会被`Promise.resolve()`包装为一个期约对象。

### await关键字
* 暂停异步函数代码的执行，等待期约解决，让出执行线程。
* 必须与`async`关键字联用，即只能出现在异步函数的定义中，否则会抛出语法错误。
* 期待一个实现`thenable`接口的对象，尝试解包期约对象的值，再异步恢复异步函数的执行。如果是一个常规值，则被当作是已经解决的期约。